<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ForensicLens | Incident Dashboard</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
    --bg: #7996e8;
    --panel: rgba(59, 76, 182, 0.05);
    --border: rgba(255,255,255,0.12);
    --accent: #38bdf8;
    --danger: #ef4444;
    --warning: #f59e0b;
    --success: #22c55e;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    background: radial-gradient(circle at top, #111827, #020617);
    color: #e5e7eb;
    font-family: 'Inter', sans-serif;
}

.container {
    max-width: 1200px;
    margin: auto;
    padding: 40px 24px;
}

/* ---------- Header ---------- */
.header {
    margin-bottom: 32px;
}

.header h1 {
    font-size: 2.4rem;
    margin: 0;
    letter-spacing: -0.5px;
}

.header span {
    color: var(--accent);
}

.case-id {
    font-family: 'JetBrains Mono', monospace;
    opacity: 0.7;
    margin-top: 6px;
}

/* ---------- Cards ---------- */
.grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
}

.card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 18px 20px;
    backdrop-filter: blur(12px);
    transition: transform .25s ease, box-shadow .25s ease;
}

.card:hover {
    transform: translateY(-4px);
    box-shadow: 0 0 0 1px var(--accent), 0 20px 40px rgba(0,0,0,0.4);
}

.card small {
    opacity: 0.7;
}

.card h3 {
    margin: 6px 0 0;
    font-size: 1.4rem;
}

/* ---------- Sections ---------- */
.section {
    margin-bottom: 36px;
}

.section h2 {
    font-size: 1.4rem;
    margin-bottom: 16px;
}

/* ---------- Timeline ---------- */
.timeline {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    max-height: 420px;
    overflow-y: auto;
}

.event {
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
    animation: slideIn .4s ease forwards;
}

.event:last-child {
    border-bottom: none;
}

.event time {
    font-family: 'JetBrains Mono', monospace;
    font-size: .85rem;
    opacity: 0.7;
}

.event-type {
    display: inline-block;
    margin: 6px 0;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: .75rem;
    font-weight: 600;
}

.AUTH_FAIL { background: rgba(239,68,68,.15); color: var(--danger); }
.USB { background: rgba(245,158,11,.15); color: var(--warning); }
.FILE_COPY { background: rgba(56,189,248,.15); color: var(--accent); }
.NETWORK { background: rgba(34,197,94,.15); color: var(--success); }
.OTHER { background: rgba(255,255,255,.1); }

.event p {
    margin: 0;
    opacity: .85;
    font-size: .9rem;
}

/* ---------- Chart ---------- */
.chart-box {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
}

/* ---------- Button ---------- */
.download {
    display: inline-block;
    margin-top: 30px;
    padding: 14px 44px;
    font-size: 1rem;
    border-radius: 999px;
    background: linear-gradient(135deg, #38bdf8, #2563eb);
    color: #fff;
    text-decoration: none;
    transition: transform .25s ease, box-shadow .25s ease;
}

.download:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(56,189,248,.5);
}

@keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}
</style>
</head>

<body>

<div class="container">

    <!-- HEADER -->
    <div class="header">
        <h1>Forensic<span>Lens</span> Dashboard</h1>
        <div class="case-id">Case ID: {{ case_id }}</div>
    </div>

    <!-- METRICS -->
    <div class="grid">
        <div class="card">
            <small>Severity</small>
            <h3 style="color:#ef4444">{{ severity }}</h3>
        </div>
        <div class="card">
            <small>Risk Score</small>
            <h3>{{ risk_score }}</h3>
        </div>
        <div class="card">
            <small>Incident Type</small>
            <h3>{{ incident_type }}</h3>
        </div>
        <div class="card">
            <small>Evidence Integrity</small>
            <h3 style="color:#22c55e">Verified</h3>
        </div>
    </div>

    <!-- NARRATIVE -->
    <div class="section">
        <h2>Attack Narrative</h2>
        <div class="card">{{ narrative }}</div>
    </div>

    <!-- TIMELINE + GRAPH -->
    <div class="grid">
        <div class="timeline">
            <h2>Incident Timeline</h2>
            {% for e in timeline %}
            <div class="event">
                <time>{{ e.timestamp }}</time><br>
                <span class="event-type {{ e.type }}">{{ e.type }}</span>
                <p>{{ e.raw }}</p>
            </div>
            {% endfor %}
        </div>

        <div class="chart-box">
            <h2>Attack Escalation</h2>
            <canvas id="timelineChart"></canvas>
        </div>
    </div>

    <!-- DOWNLOAD -->
    <a class="download" href="/download/{{ case_id }}">
    Download Forensic Report
</a>


</div>

<script>
const labels = [
{% for e in timeline %}
"{{ e.timestamp }}",
{% endfor %}
];

const risk = [
{% for e in timeline %}
{% if e.type == "AUTH_FAIL" %}1,
{% elif e.type == "USB" %}2,
{% elif e.type == "FILE_COPY" %}3,
{% elif e.type == "NETWORK" %}4,
{% else %}0,
{% endif %}
{% endfor %}
];

let cum = [], total = 0;
risk.forEach(v => { total += v; cum.push(total); });

new Chart(document.getElementById("timelineChart"), {
    type: "line",
    data: {
        labels,
        datasets: [{
            data: cum,
            borderColor: "#38bdf8",
            backgroundColor: "rgba(56,189,248,.2)",
            fill: true,
            tension: .45,
            pointRadius: 3
        }]
    },
    options: {
        plugins: { legend: { display: false }},
        scales: {
            x: { ticks: { color: "#94a3b8" }},
            y: { ticks: { color: "#94a3b8" }, beginAtZero: true }
        }
    }
});
</script>

</body>
</html>
